<div class="pg-subtitle">PATIENT PAGE - TREATEMENT PLAN</div>


<div class="doc-mainWrap">
    <div class="doc-contentArea">
        <div class="tbl-listWrap">
            <div class="sect-title">Problem:
                <!-- {{treatmentSheetData?.problem?.problem}} -->
                <mat-form-field style="margin-top: 0px;">
                    <mat-select [formControl]="problemFormControl">
                        <mat-option *ngFor="let item of treatmentSheetItems" [value]="item">
                            <div>{{ item?.problem?.problem }} - <span>({{item.createdByName}} -</span>
                                <span>{{item.createdAt|date:'short'}})</span>
                            </div>
                        </mat-option>
                    </mat-select>
                </mat-form-field>

            </div>
            <div>
                <span>Note: {{treatmentSheetData?.problem?.note}}</span>
            </div>
        </div>
        <div *ngIf="!treatmentSheetData?.completed">
            <button *ngIf="problemFormControl.valid" (click)="onEditTreatmentSheet()">Edit
                Treatment Sheet</button>
            <div class="tbl-listWrap">
                <div class="sect-title">Investigations</div>
                <table cellpadding="0" cellspacing="0" border="0.5" [formGroup]="investigationTableForm">
                    <tbody formArrayName="investigationTableArray">
                        <tr *ngIf="treatmentSheet?.investigations === undefined">
                            <td class="text-center" colspan="4"> No data available in table</td>
                        </tr>
                        <tr [formGroupName]="i" *ngFor="let investigation of investigationTableForm['controls'].investigationTableArray['controls'];let i = index">
                            <td> {{ investigation.value?.name }} </td>
                            <td>
                                <span>{{investigation.value?.status}}</span>
                            </td>
                            <td>
                                <div class="frm-item-wrap">
                                    <mat-input-container>
                                        <input matInput placeholder="Valid comment for your action" formControlName="comment">
                                    </mat-input-container>
                                </div>
                            </td>
                            <td>
                                <div *ngIf="investigation.value.status !== treatmentItemStatusValue.DONE && investigation.value.status !== treatmentItemStatusValue.SUSPENDED"
                                    class="tbl-actn-btn" (click)="onAdministerInvestigationItem(investigation.value)"><i
                                        class="fa fa-check" aria-hidden="true"></i>Done</div>
                                <div *ngIf="investigation.value.status !== treatmentItemStatusValue.DONE && investigation.value.status!==treatmentItemStatusValue.SUSPENDED"
                                    class="tbl-actn-btn" (click)="onSuspendInvestigationItem(investigation.value,true)"><i
                                        class="fa fa-check" aria-hidden="true"></i>Suspend</div>
                                <div *ngIf="investigation.value.status !== treatmentItemStatusValue.DONE && investigation.value.status === treatmentItemStatusValue.SUSPENDED"
                                    class="tbl-actn-btn" (click)="onSuspendInvestigationItem(investigation.value,false)"><i
                                        class="fa fa-check" aria-hidden="true"></i>Activate</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="tbl-listWrap">
                <div class="sect-title">Procedure</div>
                <table cellpadding="0" cellspacing="0" border="0.5" [formGroup]="procedureTableForm">
                    <tbody formArrayName="procedureTableArray">
                        <tr *ngIf="treatmentSheet?.procedures === undefined">
                            <td class="text-center" colspan="4"> No data available in table</td>
                        </tr>
                        <tr [formGroupName]="i" *ngFor="let procedure of procedureTableForm['controls'].procedureTableArray['controls'];let i = index">
                            <td> {{ procedure.value.name }} </td>
                            <td> {{ procedure.value.status }}</td>
                            <td>
                                <div class="frm-item-wrap">
                                    <mat-input-container>
                                        <input matInput placeholder="Comment" formControlName="comment">
                                    </mat-input-container>
                                </div>
                            </td>
                            <td>
                                <div *ngIf="procedure.value.status !== treatmentItemStatusValue.DONE && procedure.value.status !== treatmentItemStatusValue.SUSPENDED"
                                    (click)="onDoneProcedure(procedure.value)" class="tbl-actn-btn"><i class="fa fa-check"
                                        aria-hidden="true"></i>Done</div>
                                <div *ngIf="procedure.value.status !== treatmentItemStatusValue.DONE && procedure.value.status !== treatmentItemStatusValue.SUSPENDED"
                                    (click)="onSuspendProcedure(procedure.value,true)" class="tbl-actn-btn"><i class="fa fa-check"
                                        aria-hidden="true"></i>Suspend</div>
                                <div *ngIf="procedure.value.status !== treatmentItemStatusValue.DONE && procedure.value.status === treatmentItemStatusValue.SUSPENDED"
                                    (click)="onSuspendProcedure(procedure.value,false)" class="tbl-actn-btn"><i class="fa fa-check"
                                        aria-hidden="true"></i>Activate</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="tbl-listWrap">
                <div class="sect-title">Medication</div>
                <table cellpadding="0" cellspacing="0" border="0.5" [formGroup]="medicationTableForm">
                    <tbody formArrayName="medicationTableArray">
                        <tr *ngIf="treatmentSheet?.medications === undefined">
                            <td class="text-center" colspan="5"> No data available in table</td>
                        </tr>
                        <tr [formGroupName]="i" *ngFor="let medication of medicationTableForm['controls'].medicationTableArray['controls'];let i = index">
                            <td>{{ medication?.value.name }}</td>
                            <td>{{ medication?.value.status }}</td>
                            <td>
                                <div class="frm-item-wrap">
                                    <mat-input-container>
                                        <input matInput placeholder="Comment" formControlName="comment">
                                    </mat-input-container>
                                </div>
                            </td>
                            <td class="action-placeholder" style="text-align:center;">
                                <i class="fa fa-ellipsis-h" aria-hidden="true"></i>
                                <div class="action-container shadow-RB">
                                    <div *ngIf="medication.value.status!==treatmentItemStatusValue.SUSPENDED && medication.value.status!==treatmentItemStatusValue.COMPLETED && medication.value.status!==treatmentItemStatusValue.DISCONTINUED"
                                        (click)="administer(medication.value)" class="action-item">
                                        <i class="fa fa-user-md" aria-hidden="true"></i>
                                        <span>Administer</span>
                                    </div>

                                    <div *ngIf="medication.value.status!==treatmentItemStatusValue.SUSPENDED && 
                                            medication.value.status!==treatmentItemStatusValue.COMPLETED && medication.value.status!==treatmentItemStatusValue.DISCONTINUED"
                                        (click)="suspendMedication(medication.value)" class="action-item">
                                        <i class="fa fa-pause text-yellow" aria-hidden="true"></i>
                                        <span>Suspend</span>
                                    </div>
                                    <div *ngIf="medication.value.status===treatmentItemStatusValue.SUSPENDED || medication.value.status===treatmentItemStatusValue.COMPLETED || medication.value.status!==treatmentItemStatusValue.DISCONTINUED"
                                        (click)="activateMedication(medication.value)" class="action-item">
                                        <i class="fa fa-play text-green" aria-hidden="true"></i>
                                        <span>Activate</span>
                                    </div>

                                    <div *ngIf="medication.value.status!==treatmentItemStatusValue.SUSPENDED && medication.value.status!==treatmentItemStatusValue.COMPLETED && medication.value.status!==treatmentItemStatusValue.DISCONTINUED"
                                        (click)="discontinueMedication(medication.value)" class="action-item">
                                        <i class="fa fa-ban text-red" aria-hidden="true"></i>
                                        <span>Discontinue</span>
                                    </div>

                                    <div *ngIf="medication.value.status!==treatmentItemStatusValue.SUSPENDED && 
                                            medication.value.status!==treatmentItemStatusValue.COMPLETED && 
                                            medication.value.status!==treatmentItemStatusValue.DISCONTINUED"
                                        (click)="completeMedication(medication.value)" class="action-item">
                                        <i class="fa fa-check text-green" aria-hidden="true"></i>
                                        <span>Completed</span>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="tbl-listWrap">
                <div class="sect-title">Nursing Care</div>
                <table cellpadding="0" cellspacing="0" border="0.5" [formGroup]="nursingCareTableForm">
                    <tbody formArrayName="nursingCareTableArray">
                        <tr *ngIf="treatmentSheet?.nursingCares === undefined">
                            <td class="text-center" colspan="4"> No data available in table</td>
                        </tr>
                        <tr [formGroupName]="i" *ngFor="let nursingCare of nursingCareTableForm['controls'].nursingCareTableArray['controls'];let i = index">
                            <td> {{ nursingCare.value.name }} </td>
                            <td> {{ nursingCare.value.status }}</td>
                            <td>
                                <div class="frm-item-wrap">
                                    <mat-input-container>
                                        <input matInput placeholder="Comment" formControlName="comment">
                                    </mat-input-container>
                                </div>
                            </td>
                            <td>
                                <div *ngIf="nursingCare.value.status !== treatmentItemStatusValue.DONE && nursingCare.value.status !== treatmentItemStatusValue.SUSPENDED"
                                    (click)="onDoneNursingCare(nursingCare.value)" class="tbl-actn-btn">
                                    <i class="fa fa-check" aria-hidden="true"></i> Done <span class="fa fa-spinner fa-spin"></span>
                                </div>
                                <div *ngIf="nursingCare.value.status !== treatmentItemStatusValue.DONE && nursingCare.value.status !== treatmentItemStatusValue.SUSPENDED"
                                    (click)="onSuspendNursingCare(nursingCare.value,true)" class="tbl-actn-btn">
                                    <i class="fa fa-check" aria-hidden="true"></i> <span> Suspend </span>
                                </div>
                                <div *ngIf="nursingCare.value.status !== treatmentItemStatusValue.DONE && nursingCare.value.status === treatmentItemStatusValue.SUSPENDED"
                                    (click)="onSuspendNursingCare(nursingCare.value,false)" class="tbl-actn-btn">
                                    <i class="fa fa-check" aria-hidden="true"></i><span> Activate </span>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="tbl-listWrap">
                <div class="sect-title">Physician Order</div>
                <table cellpadding="0" cellspacing="0" border="0.5" [formGroup]="physicianOrderTableForm">
                    <tbody formArrayName="physicianOrderTableArray">
                        <tr *ngIf="treatmentSheet?.physicianOrders === undefined">
                            <td class="text-center" colspan="4"> No data available in table</td>
                        </tr>
                        <tr [formGroupName]="i" *ngFor="let physicianOrder of physicianOrderTableForm['controls'].physicianOrderTableArray['controls'];let i = index">
                            <td> {{ physicianOrder.value.name }} </td>
                            <td> {{ physicianOrder.value.status }}</td>
                            <td>
                                <div class="frm-item-wrap">
                                    <mat-input-container>
                                        <input matInput placeholder="Comment" formControlName="comment">
                                    </mat-input-container>
                                </div>
                            </td>
                            <td>
                                <div *ngIf="physicianOrder.value.status !== treatmentItemStatusValue.DONE && physicianOrder.value.status !== treatmentItemStatusValue.SUSPENDED"
                                    (click)="onDonePhysicianOrderItem(physicianOrder.value)" class="tbl-actn-btn"><i
                                        class="fa fa-check" aria-hidden="true"></i>Done</div>
                                <div *ngIf="physicianOrder.value.status !== treatmentItemStatusValue.DONE && physicianOrder.value.status !== treatmentItemStatusValue.SUSPENDED"
                                    (click)="onSuspendPhysicianOrderItem(physicianOrder.value,true)" class="tbl-actn-btn"><i
                                        class="fa fa-check" aria-hidden="true"></i>Suspend</div>
                                <div *ngIf="physicianOrder.value.status !== treatmentItemStatusValue.DONE && physicianOrder.value.status === treatmentItemStatusValue.SUSPENDED"
                                    (click)="onSuspendPhysicianOrderItem(physicianOrder.value,false)" class="tbl-actn-btn"><i
                                        class="fa fa-check" aria-hidden="true"></i>Activate</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="buttom-sect">
                <div class="frm-item-wrap">
                    <textarea [formControl]="completionInfo" style="border:1px solid #777; padding:10px;box-sizing:border-box;background:#fff;"
                        matInput class="textarea" placeholder="Notes"></textarea>
                </div>
                <div (click)="onCompletedTreatmentSheet()" class="cta-1"><i class="fa fa-floppy-o" aria-hidden="true"></i>Save</div>
            </div>
            <div style="clear:right;"></div>
        </div>
        <div>
            <div class="tbl-listWrap">
                <div class="sect-title">Treatment Sheet Tracks</div>
                <div class="sect-title">{{treatmentSheetData?.problem?.problem}}</div>
                <div class="sect-title">{{treatmentSheetData?.completionDescription}}</div>
                <table cellpadding="0" cellspacing="0" border="0.5">
                    <tbody>
                        <tr *ngFor="let item of trackValues">
                            <td class="sect-title">
                                {{item.label}}
                        <tr *ngFor="let track of item.tracks;let i=index">
                            <td>
                                <div class="sect-title">{{track.name}}</div>
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Employee</th>
                                        <th>Action</th>
                                        <th>Comment</th>
                                    </tr>
                                </thead>

                    <tbody>
                        <tr *ngFor="let activity of track.tracks">
                            <td>{{activity.createdAt|date:'medium'}}</td>
                            <td (click)="onViewEmployee(activity)"><span *ngIf="activity.createdByName===undefined">View
                                    employee</span><span>{{activity?.createdByName}}</span></td>
                            <td>{{activity.action}}</td>
                            <td>{{activity.comment}}</td>
                        </tr>
                    </tbody>
                    </td>
                    </tr>
                    </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>
<div *ngIf="isEditTreatmentSheet" class="modal-overlay">
    <app-order-set [selectedPatient]="patient" [treatmentSheetId]="treatmentSheetId" (closeModal)="close_onClick($event)"></app-order-set>
</div>