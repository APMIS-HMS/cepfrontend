<table cellpadding="0" cellspacing="0" border="0.5">
    <thead>
        <tr>
            <th>
                <i class="fa fa-sort-alpha-asc" aria-hidden="true"></i>
                <!--<i class="fa fa-sort-alpha-desc" aria-hidden="true"></i>-->
                <span style="padding-left: 3px;">Patient</span>
            </th>
            <th>
                <i class="fa fa-sort-alpha-asc" aria-hidden="true"></i>
                <!--<i class="fa fa-sort-alpha-desc" aria-hidden="true"></i>-->
                <span style="padding-left: 3px;">Age</span>
            </th>
            <th>
                <i class="fa fa-sort-alpha-asc" aria-hidden="true"></i>
                <!--<i class="fa fa-sort-alpha-desc" aria-hidden="true"></i>-->
                <span style="padding-left: 3px;">Gender</span>
            </th>
            <th>
                <i class="fa fa-sort-alpha-asc" aria-hidden="true"></i>
                <!--<i class="fa fa-sort-alpha-desc" aria-hidden="true"></i>-->
                <span style="padding-left: 3px;">Phone</span>
            </th>
            <th>
                <i class="fa fa-sort-alpha-asc" aria-hidden="true"></i>
                <!--<i class="fa fa-sort-alpha-desc" aria-hidden="true"></i>-->
                <span style="padding-left: 3px;">Email</span>
            </th>
            <!-- <th>
                <i class="fa fa-sort-alpha-asc" aria-hidden="true"></i> -->
            <!--<i class="fa fa-sort-alpha-desc" aria-hidden="true"></i>-->
            <!-- <span style="padding-left: 3px;">Address</span>
            </th> -->
            <th>
                <i class="fa fa-sort-alpha-asc" aria-hidden="true"></i>
                <!--<i class="fa fa-sort-alpha-desc" aria-hidden="true"></i>-->
                <span style="padding-left: 3px;">Born</span>
            </th>
            <th>
                <i class="fa fa-sort-alpha-asc" aria-hidden="true"></i>
                <!--<i class="fa fa-sort-alpha-desc" aria-hidden="true"></i>-->
                <span style="padding-left: 3px;">Apmis ID</span>
            </th>
            <th></th>
        </tr>
    </thead>

    <tbody>
        <tr *ngFor="let patient of patients">
            <td class="pointer" (click)="navEpDetail(patient)">
                <div class="empWrap">
                    <div class="list-img">
                        <div *ngIf="patient?.personDetails?.profileImageObject == undefined">
                            <img src="assets/images/users/default.png">
                        </div>
                        <div *ngIf="patient?.personDetails?.profileImageObject != undefined">
                            <img class="shadow" [src]="facilityService.transform(patient?.personDetails?.profileImageObject?.thumbnail)">
                        </div>
                    </div>
                    <div>{{patient.personDetails?.lastName}} {{patient.personDetails?.firstName}}</div>
                </div>
            </td>
            <td class="pointer" (click)="navEpDetail(patient)">{{patient.personDetails?.age}}</td>
            <td class="pointer" (click)="navEpDetail(patient)">
                <span *ngIf="patient.personDetails?.gender ==='Male'">M</span>
                <span *ngIf="patient.personDetails?.gender ==='Female'">F</span>
                <span *ngIf="patient.personDetails?.gender!='Female' && patient.personDetails?.gender!='Male'">N</span>
            </td>
            <td class="pointer" (click)="navEpDetail(patient)">{{patient.personDetails?.primaryContactPhoneNo}}</td>
            <td class="pointer" (click)="navEpDetail(patient)">{{patient.personDetails?.email}}</td>
            <!-- <td class="pointer" (click)="navEpDetail(patient)">{{patient.personDetails.homeAddress.street}} {{patient.personDetails.addressObj.city}} {{patient.personDetails.addressObj.state}} {{patient.personDetails.addressObj.country}}</td> -->
            <td class="pointer" (click)="navEpDetail(patient)">{{patient.personDetails?.dateOfBirth | date}}</td>
            <td class="pointer" (click)="navEpDetail(patient)">{{patient.personDetails?.apmisId}}</td>
            <td class="action-placeholder" style="text-align:center;">
                <i class="fa fa-ellipsis-h" aria-hidden="true"></i>
                <div class="action-container shadow-RB">
                    <div (click)="slideEdit(patient)" class="action-item">
                        <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                        <span>Edit Patient</span>
                    </div>

                    <div (click)="setAppointment(patient)" class="action-item">
                        <i class="fa fa-calendar-plus-o" aria-hidden="true"></i>
                        <span>Set Appointment</span>
                    </div>

                    <div (click)="payPlanShow(patient)" class="action-item">
                        <i class="fa fa-money" aria-hidden="true"></i>
                        <span>Payment Plans</span>
                    </div>

                    <div (click)="newUpload_show()" class="action-item">
                        <i class="fa fa-cloud-upload" aria-hidden="true"></i>
                        <span>Upload File</span>
                    </div>
                    <input style="display:none;" #fileInput type="file" id="uploadResult" (click)="onChange($event)">
                </div> 
            </td>
        </tr>
        <tr *ngIf="patients.length === 0 && !loading">
            <td class="table-content" colspan="9" style="text-align: center !important; padding: 10px !important;"> No data available in table</td>
        </tr>
        <tr *ngIf="patients.length === 0 && loading">
            <td class="table-content" colspan="9" style="text-align: center !important; padding: 10px !important;">
                <i class="fa fa-circle-o-notch fa-spin fa-3x text-blue" aria-hidden="true"></i>
            </td>
        </tr>

        <!--<div *ngIf="loadIndicatorVisible" class="div_loading">
            <mat-spinner></mat-spinner>
        </div>-->
    </tbody>
</table>

<div class="btn-center">
    <button (click)="loadMore()" class="apmis-blue" mat-raised-button *ngIf="showLoadMore">Load More</button>
</div>
<div style="text-align:center; margin-top:20px;" *ngIf="total > 0">{{loadMoreText}} </div>
<div *ngIf="editPatient">
    <!--<div class="slidePage">
        <p>whoopy</p>
    </div>-->
    <div class="survery">
        <div class="cover-edit">
            <form class="form-signin">
                <div class="container">
                    <div class="row">
                        <div class="col-md-8 col-md-offset-2">
                            <div class="panel panel-default">
                                <div class="panel-body">
                                    <a (click)="close_onClick()" aria-hidden="true" class="modal-close-ico">X</a>
                                    <legend class="modal_title">Edit Patient</legend>
                                    <form class="form form-signup" role="form" [formGroup]="patientEditForm">
                                        <mat-tab-group style="padding: 10px;">
                                            <mat-tab label="Patient" style="padding: 10px;">
                                                <div class="patient-detail-wrapper">
                                                    <div class="col-sm-6">
                                                        <mat-form-field>
                                                            <mat-select formControlName="title" placeholder="Title">
                                                                <mat-option *ngFor="let title of titles" [value]="title.name">
                                                                    {{title.name}}
                                                                </mat-option>
                                                            </mat-select>
                                                        </mat-form-field>
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <mat-input-container>
                                                            <input matInput formControlName="firstName" placeholder="First Name" name="firstName" [(ngModel)]="selectedPatient.firstName">
                                                        </mat-input-container>
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <mat-input-container>
                                                            <input matInput formControlName="lastName" placeholder="Last Name" name="lastName" [(ngModel)]="selectedPatient.lastName">
                                                        </mat-input-container>
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <mat-input-container>
                                                            <input matInput type="email" formControlName="email" placeholder="Email" name="email" [(ngModel)]="selectedPatient.email">
                                                        </mat-input-container>
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <mat-input-container>
                                                            <input matInput type="number" formControlName="phoneNumber" placeholder="Mobile Number" name="phoneNumber" [(ngModel)]="selectedPatient.primaryContactPhoneNo">
                                                        </mat-input-container>
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <mat-form-field>
                                                            <mat-select formControlName="gender" placeholder="Gender">
                                                                <mat-option *ngFor="let gender of genders" [value]="gender.name">
                                                                    {{gender.name}}
                                                                </mat-option>
                                                            </mat-select>
                                                        </mat-form-field>
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <mat-form-field>
                                                            <mat-select placeholder="Country" formControlName="country">
                                                                <mat-option *ngFor="let country of countries" [value]="country.name">
                                                                    {{country.name}}
                                                                </mat-option>
                                                            </mat-select>
                                                        </mat-form-field>
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <mat-form-field>
                                                            <mat-select placeholder="State" formControlName="state" [compareWith]="compareState">
                                                                <mat-option *ngFor="let state of states" [value]="state.name">
                                                                    {{state.name}}
                                                                </mat-option>
                                                            </mat-select>
                                                        </mat-form-field>
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <mat-form-field>
                                                            <mat-select placeholder="City" formControlName="city" [compareWith]="compareState">
                                                                <mat-option *ngFor="let city of cities" [value]="city.name">
                                                                    {{city.name}}
                                                                </mat-option>
                                                            </mat-select>
                                                        </mat-form-field>
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <mat-form-field>
                                                            <mat-select placeholder="L.G.A" formControlName="lga" [compareWith]="compareState">
                                                                <mat-option *ngFor="let lga of lgas" [value]="lga.name">
                                                                    {{lga.name}}
                                                                </mat-option>
                                                            </mat-select>
                                                        </mat-form-field>
                                                    </div>
                                                    <div class="col-xs-12">
                                                        <mat-input-container style="width: 100%;">
                                                            <textarea matInput placeholder="Street" formControlName="street"></textarea>
                                                        </mat-input-container>
                                                    </div>
                                                </div>
                                            </mat-tab>
                                            <mat-tab label="Next Of Kin">
                                                <div class="next-of-kin-body-wrapper">
                                                    <div formArrayName="nextOfKin">
                                                        <div *ngFor="let nextOfKin of patientEditForm.controls.nextOfKin.controls; let i=index" class="next-of-kin panel panel-default">
                                                            <div class="panel-heading">
                                                                <span>Next Of Kin {{i + 1}}</span>
                                                                <span *ngIf="patientEditForm.controls.nextOfKin.controls.length > 1" (click)="removeNextOfKin(i)" style="float: right;">
                                                                    <i class="fa fa-times"></i>
                                                                </span>
                                                            </div>
                                                            <div class="panel-body" [formGroupName]="i">
                                                                <mat-input-container class="example-full-width">
                                                                    <input matInput type="text" formControlName="fullName" placeholder="Full Name">
                                                                </mat-input-container>
                                                                <mat-input-container class="example-full-width" style="margin-left: 5px;">
                                                                    <input matInput placeholder="Address" formControlName="address">
                                                                </mat-input-container>
                                                                <mat-input-container class="example-full-width">
                                                                    <input matInput type="number" placeholder="Mobile Number" formControlName="phoneNumber">
                                                                </mat-input-container>
                                                                <mat-input-container class="example-full-width" style="margin-left: 5px;">
                                                                    <input matInput type="email" placeholder="Email" formControlName="email">
                                                                </mat-input-container>
                                                                <mat-form-field>
                                                                    <mat-select placeholder="Relationship" formControlName="relationship">
                                                                        <mat-option *ngFor="let relationship of relationships" [value]="relationship._id">
                                                                            {{relationship.name}}
                                                                        </mat-option>
                                                                    </mat-select>
                                                                </mat-form-field>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- <div *ngFor="let next of selectedPatient.nextOfKin">
                                                    <mat-input-container class="example-full-width">
                                                        <input matInput type="text" [(ngModel)]="next.fullName" name="fullName" placeholder="Full Name">
                                                    </mat-input-container>
                                                    <mat-input-container class="example-full-width">
                                                        <input matInput placeholder="Address" [(ngModel)]="next.address" name="address">
                                                    </mat-input-container>
                                                    <mat-input-container class="example-full-width">
                                                        <input matInput type="number" placeholder="Mobile Number" [(ngModel)]="next.phoneNumber" name="phoneNumber">
                                                    </mat-input-container>
                                                    <mat-input-container class="example-full-width">
                                                        <input matInput type="email" placeholder="Email" [(ngModel)]="next.email" name="email">
                                                    </mat-input-container>
                                                    <mat-select placeholder="Relationship" [(ngModel)]="next.relationship" name="relationship">
                                                        <mat-option *ngFor="let relationship of relationships" [value]="relationship._id">
                                                            {{relationship.name}}
                                                        </mat-option>
                                                    </mat-select>
                                                </div>
                                                <div *ngIf="selectedPatient.nextOfKin.length == 0">
                                                    <form [formGroup]="nextOfKinForm">
                                                        <mat-input-container class="example-full-width">
                                                            <input matInput type="text" formControlName="fullName" placeholder="Full Name">
                                                        </mat-input-container>
                                                        <mat-input-container class="example-full-width">
                                                            <input matInput placeholder="Address" formControlName="address">
                                                        </mat-input-container>
                                                        <mat-input-container class="example-full-width">
                                                            <input matInput type="number" placeholder="Mobile Number" formControlName="phoneNumber">
                                                        </mat-input-container>
                                                        <mat-input-container class="example-full-width">
                                                            <input matInput type="email" placeholder="Email" formControlName="email">
                                                        </mat-input-container>
                                                        <mat-select placeholder="Relationship" formControlName="relationship" name="relationship">
                                                            <mat-option *ngFor="let relationship of relationships" [value]="relationship._id">
                                                                {{relationship.name}}
                                                            </mat-option>
                                                        </mat-select>
                                                    </form>
                                                </div> -->
                                                <div class="add-next-of-kin-box">
                                                    <a (click)="addNewNextOfKin();"> Add Next Of Kin
                                                        <i class="fa fa-plus"></i>
                                                    </a>
                                                </div>
                                            </mat-tab>
                                            <mat-tab label="Plan">
                                                <div class="next-of-kin-body-wrapper">
                                                    Patient Plan
                                                </div>
                                            </mat-tab>
                                        </mat-tab-group>
                                    </form>
                                </div>
                                <div class="example-full-width" id="example-full-width">
                                    <button [disabled]="!patientEditForm.valid" (click)="updatePatient(patientEditForm.value, patientEditForm.valid)" class="apmis-blue"
                                        mat-raised-button [innerHtml]="updatePatientBtnText"></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>


<div *ngIf="payPlan" class="modal-overlay">
    <app-patient-payment-plan [selectedPatient]="selectedPatient" (closeModal)="close_onClick($event)" id="form-modal" class="form-modal center-center"></app-patient-payment-plan>
</div>
<div *ngIf="newUpload" class="modal-overlay">
    <app-doc-upload (closeModal)="close_onClick($event)" id="form-modal" class="form-modal center-center"></app-doc-upload>
</div>